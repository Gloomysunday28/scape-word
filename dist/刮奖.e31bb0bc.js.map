{"version":3,"sources":["index.js"],"names":["Scrap","canvas","document","getElementsByTagName","offsetX","getBoundingClientRect","left","offsetY","top","ctx","getContext","width","getAttribute","height","initScrap","beginPath","fillStyle","fillRect","font","textAlign","textBaseline","fillText","globalCompositeOperation","closePath","initMouseEvent","onmousedown","e","onmousemove","clientX","clientY","judgeIsEnd","window","onmouseup","ontouchstart","ontouchmove","touches","ontouchend","image","getImageData","prvData","data","length","i","count","alpha","clearRect","console","log","scrap"],"mappings":"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","file":"刮奖.e31bb0bc.js","sourceRoot":"..","sourcesContent":["class Scrap {\r\n  constructor () {\r\n    this.canvas = document.getElementsByTagName ('canvas')[0];\r\n    this.offsetX = this.canvas.getBoundingClientRect ().left;\r\n    this.offsetY = this.canvas.getBoundingClientRect ().top;\r\n    this.ctx = this.canvas.getContext ('2d'); // 拿起画笔\r\n    this.width = this.canvas.getAttribute ('width');\r\n    this.height = this.canvas.getAttribute ('height');\r\n    this.initScrap ();\r\n  }\r\n  initScrap () {\r\n    this.ctx.beginPath ();\r\n    this.ctx.fillStyle = '#ddd';\r\n    this.ctx.fillRect (0, 0, this.width, this.height);\r\n    this.ctx.font = '48px 微软雅黑';\r\n    this.ctx.fillStyle = '#fff';\r\n    this.ctx.textAlign = 'center';\r\n    this.ctx.textBaseline = 'middle';\r\n    this.ctx.fillText ('刮开有奖', this.width / 2, this.height / 2);\r\n    this.ctx.globalCompositeOperation = 'destination-out'; // 将canvas变透明,清除画布的时候可以显示下面的背景图\r\n    this.ctx.closePath ();\r\n    this.initMouseEvent ();\r\n  }\r\n  initMouseEvent () {\r\n    // Pc端\r\n    this.canvas.onmousedown = e => {\r\n      this.canvas.onmousemove = e => {\r\n        this.ctx.fillStyle = '#fff';\r\n        this.ctx.fillRect (\r\n          e.clientX - this.offsetX - 10,\r\n          e.clientY - this.offsetY - 10,\r\n          30,\r\n          30\r\n        );\r\n        this.judgeIsEnd ();\r\n      };\r\n    };\r\n    window.onmouseup = e => {\r\n      this.canvas.onmousemove = null;\r\n    };\r\n\r\n    // 适配移动端\r\n    this.canvas.ontouchstart = e => {\r\n      this.canvas.ontouchmove = e => {\r\n        e = e.touches[0]\r\n        this.ctx.fillStyle = '#fff';\r\n        this.ctx.fillRect (\r\n          e.clientX - this.offsetX - 10,\r\n          e.clientY - this.offsetY - 10,\r\n          30,\r\n          30\r\n        );\r\n        this.judgeIsEnd ();\r\n      };\r\n    };\r\n    window.ontouchend = e => {\r\n      this.canvas.onmousemove = null;\r\n    };\r\n  }\r\n  judgeIsEnd () {\r\n    const image = this.ctx.getImageData(0, 0, this.width, this.height) // 转换为base64进制\r\n    const prvData = image.data // 获取像素点， prv[n]代表r, prv[n + 1]代表g, prv[n + 2]代表b, prv[3 + n]代表a \r\n    const length = prvData.length //\r\n    let i = 0\r\n    let count = 0\r\n    while(i < length) {\r\n      const alpha = prvData[i + 3] // 收集透明点\r\n      if (alpha < 10) {\r\n        count++\r\n      }\r\n      i += 4\r\n    }\r\n    if ((count / (length / 4)) > .8) { // 如果透明点个数高于.8,代表刮奖结束\r\n      this.ctx.clearRect(0, 0, this.width, this.height)\r\n      console.log('刮奖结束')\r\n    }\r\n  }\r\n}\r\n\r\nconst scrap = new Scrap ();\r\n"]}